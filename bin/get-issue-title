#!/usr/bin/env bash

# - name: setup
#   run: |
#     echo "GITHUB_TOKEN=${{ secrets.GH_TOKEN }}" >> $GITHUB_ENV

# - name: get issue title
#   run: |
#     for an issue
#     echo "ISSUE_URL=${{ github.event.issue.url }}" >> $GITHUB_ENV
#     for pull request
#     echo "ISSUE_URL=${{ github.api_url }}/repos/${{ github.repository }}/issues/${{ github.event.number }}" >> $GITHUB_ENV
#     echo "TITLE=$(bin/get-issue-title)" >> $GITHUB_ENV

[ -z "$GITHUB_ENV" ] || . $GITHUB_ENV

if [ -z "$GITHUB_TOKEN" ]; then
  echo "GITHUB_TOKEN is not setup"
  exit 1
fi

if [ -z "$ISSUE_URL" ]; then
  echo "ISSUE_URL is not setup"
  exit 1
fi

curl -s -X GET $ISSUE_URL \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: token $GITHUB_TOKEN" \
  | grep "title" | awk 'BEGIN { FS = "\"" } ; {print $4}'